<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch Together</title>
<meta name="referrer" content="no-referrer">
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #0b0b0b;
    color: white;
    font-family: system-ui, Segoe UI, Roboto;
  }
  .app {
    display: grid;
    grid-template-rows: 56px 1fr;
    height: 100%;
  }
  header {
    display: flex;
    align-items: center;
    padding: 0 16px;
    background: #111;
    border-bottom: 1px solid #222;
    font-weight: 600;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: black;
  }
  .status {
    font-size: 12px;
    opacity: .7;
    margin-left: auto;
  }
</style>
</head>
<body>

<div class="app">
  <header>
    ðŸŽ¬ Watch Together
    <span class="status" id="status">loadingâ€¦</span>
  </header>

  <iframe
    id="player"
    allow="autoplay; fullscreen"
    sandbox="allow-scripts allow-presentation"
  ></iframe>
</div>

<script>
/* ============================
   CONFIG
============================ */

const VIDEO_ID = "hgYhws0AHcg";

const SOURCES = [
  { name: "Invidious", url: id => `https://vid.puffyan.us/embed/${id}` },
  { name: "Invidious", url: id => `https://inv.nadeko.net/embed/${id}` },
  { name: "Invidious", url: id => `https://invidious.jing.rocks/embed/${id}` },
  { name: "Piped",     url: id => `https://piped.video/embed/${id}` },
  { name: "Piped",     url: id => `https://piped.adminforge.de/embed/${id}` }
];

/* ============================
   LOGIC
============================ */

const iframe = document.getElementById("player");
const status = document.getElementById("status");

let index = 0;
let timeout;

function loadNext(reason) {
  clearTimeout(timeout);

  if (index >= SOURCES.length) {
    status.textContent = "âŒ all sources failed";
    console.error("All video sources failed");
    return;
  }

  const source = SOURCES[index++];
  status.textContent = `trying ${source.name}â€¦`;

  iframe.src = source.url(VIDEO_ID);

  // If it doesnâ€™t load media within 6s â†’ rotate
  timeout = setTimeout(() => {
    loadNext("timeout");
  }, 6000);
}

// If iframe errors â†’ rotate
iframe.addEventListener("error", () => loadNext("error"));

// If it loads successfully â†’ stop rotating
iframe.addEventListener("load", () => {
  status.textContent = "â–¶ playing";
  clearTimeout(timeout);
});

// Start
loadNext();
</script>

</body>
</html>
